set -e

# Day11/cicd 하위에서 스테이징된 JS/TS만 추출
STAGED="$(git diff --name-only --cached --diff-filter=ACMRTUXB \
  | grep -E '^Day11/cicd/.*\.(js|jsx|ts|tsx)$' || true)"

if [ -z "$STAGED" ]; then
  echo "No staged files in Day11/cicd. Skipping tests."
  exit 0
fi

echo "Running related tests for staged changes:"
echo "$STAGED" | sed 's/^/  • /'

# 방법 A) Day11/cicd의 jest를 직접 실행
npm --prefix Day11/cicd exec -- \
  jest --findRelatedTests --passWithNoTests $STAGED